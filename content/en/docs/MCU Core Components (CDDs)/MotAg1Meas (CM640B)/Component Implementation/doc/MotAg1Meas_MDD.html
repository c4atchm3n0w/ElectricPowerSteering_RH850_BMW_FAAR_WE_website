---
title: MotAg1Meas_MDD
linkTitle: MotAg1Meas_MDD
weight: 3
---

<p><strong>Module Design Document</strong></p>
<p><strong>For</strong></p>
<p><strong>Motor Angle 1 Measurement</strong></p>
<p><strong>May 04, 2018</strong></p>
<p><strong>Prepared By:</strong></p>
<p><strong>Avinash James</strong></p>
<p><strong>Software Engineering</strong></p>
<p><strong>Nexteer Automotive,</strong></p>
<p><strong>Saginaw, MI, USA</strong></p>
<p><strong><br />
<u>Change History</u></strong></p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 28%" />
<col style="width: 18%" />
<col style="width: 19%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Description</strong></td>
<td><strong>Author</strong></td>
<td><strong>Version</strong></td>
<td><strong>Date</strong></td>
</tr>
<tr class="even">
<td>Initial Version</td>
<td>Avinash James</td>
<td>1.0</td>
<td>07-Jun-2016</td>
</tr>
<tr class="odd">
<td>Removed local function CalcTurnCntr</td>
<td>Avinash James</td>
<td>2.0</td>
<td>13-Jun-2016</td>
</tr>
<tr class="even">
<td>Added local function ProcTurnCntrReg. Added constants required for bitshifting and signal limiting. Added limiting block for output MotAg1TurnCntr.</td>
<td>Brendon Binder</td>
<td>3.0</td>
<td>25-Aug-2017</td>
</tr>
<tr class="odd">
<td>Update to FDD 4.1.0 added MotAg1WarnReg function</td>
<td>Mateusz Bartocha</td>
<td>4.0</td>
<td>23-Oct-17</td>
</tr>
<tr class="even">
<td>Fix – Missed MotAg1TurnCntrRollgCntr output</td>
<td>Mateusz Bartocha</td>
<td>5</td>
<td>21-Nov-17</td>
</tr>
<tr class="odd">
<td>Updated Diagram &amp; Unit Test Considerations</td>
<td>Matthew Leser</td>
<td>6.0</td>
<td>14-Dec-2017</td>
</tr>
<tr class="even">
<td>Updated as per Design version 5.0.0</td>
<td>Krzysztof Byrski</td>
<td>7.0</td>
<td>25-Apr-2018</td>
</tr>
<tr class="odd">
<td>Added ports for IO access</td>
<td>Avinash James</td>
<td>8.0</td>
<td>27-Apr-2018</td>
</tr>
<tr class="even">
<td>Added updates for sensor offset learning</td>
<td>Avinash James</td>
<td>9.0</td>
<td>04-May-2018</td>
</tr>
</tbody>
</table>
<p><strong><br />
</strong></p>
<p><u>Table of Contents</u></p>
<p><a href="#introduction">1 Introduction <span>5</span></a></p>
<p><a href="#purpose">1.1 Purpose <span>5</span></a></p>
<p><a href="#scope">1.2 Scope <span>5</span></a></p>
<p><a href="#motag1meashigh-level-description">2 MotAg1Meas High-Level Description <span>6</span></a></p>
<p><a href="#design-details-of-software-module">3 Design details of software module <span>7</span></a></p>
<p><a href="#graphical-representation-of-motag1meas">3.1 Graphical representation of MotAg1Meas <span>7</span></a></p>
<p><a href="#data-flow-diagram">3.2 Data Flow Diagram <span>7</span></a></p>
<p><a href="#component-level-dfd">3.2.1 Component level DFD <span>7</span></a></p>
<p><a href="#function-level-dfd">3.2.2 Function level DFD <span>7</span></a></p>
<p><a href="#constant-data-dictionary">4 Constant Data Dictionary <span>8</span></a></p>
<p><a href="#program-fixed-constants">4.1 Program (fixed) Constants <span>8</span></a></p>
<p><a href="#embedded-constants">4.1.1 Embedded Constants <span>8</span></a></p>
<p><a href="#software-component-implementation">5 Software Component Implementation <span>9</span></a></p>
<p><a href="#sub-module-functions">5.1 Sub-Module Functions <span>9</span></a></p>
<p><a href="#init-motag1measinit1">5.1.1 Init: MotAg1MeasInit1 <span>9</span></a></p>
<p><a href="#design-rationale">5.1.1.1 Design Rationale <span>9</span></a></p>
<p><a href="#module-outputs">5.1.1.2 Module Outputs <span>9</span></a></p>
<p><a href="#module-internal">5.1.1.3 Module Internal <span>9</span></a></p>
<p><a href="#per-motag1measper1">5.1.2 Per: MotAg1MeasPer1 <span>9</span></a></p>
<p><a href="#design-rationale-1">5.1.2.1 Design Rationale <span>9</span></a></p>
<p><a href="#store-module-inputs-to-local-copies">5.1.2.2 Store Module Inputs to Local copies <span>9</span></a></p>
<p><a href="#processing-of-function">5.1.2.3 (Processing of function)……… <span>9</span></a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs">5.1.2.4 Store Local copy of outputs into Module Outputs <span>9</span></a></p>
<p><a href="#per-motag1measper2">5.1.3 Per: MotAg1MeasPer2 <span>9</span></a></p>
<p><a href="#design-rationale-2">5.1.3.1 Design Rationale <span>9</span></a></p>
<p><a href="#store-module-inputs-to-local-copies-1">5.1.3.2 Store Module Inputs to Local copies <span>10</span></a></p>
<p><a href="#processing-of-function-1">5.1.3.3 (Processing of function)……… <span>10</span></a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs-1">5.1.3.4 Store Local copy of outputs into Module Outputs <span>10</span></a></p>
<p><a href="#server-runnables-motag1coefftblread">5.2 Server Runnables: MotAg1CoeffTblRead <span>10</span></a></p>
<p><a href="#design-rationale-3">5.2.1.1 Design Rationale <span>10</span></a></p>
<p><a href="#store-module-inputs-to-local-copies-2">5.2.1.2 Store Module Inputs to Local copies <span>10</span></a></p>
<p><a href="#processing-of-function-2">5.2.1.3 (Processing of function)……… <span>10</span></a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs-2">5.2.1.4 Store Local copy of outputs into Module Outputs <span>10</span></a></p>
<p><a href="#server-runnables-motag1coefftblwr">5.3 Server Runnables: MotAg1CoeffTblWr <span>10</span></a></p>
<p><a href="#design-rationale-4">5.3.1.1 Design Rationale <span>10</span></a></p>
<p><a href="#store-module-inputs-to-local-copies-3">5.3.1.2 Store Module Inputs to Local copies <span>10</span></a></p>
<p><a href="#processing-of-function-3">5.3.1.3 (Processing of function)……… <span>10</span></a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs-3">5.3.1.4 Store Local copy of outputs into Module Outputs <span>10</span></a></p>
<p><a href="#server-runnables-motag1cfglopwrmod">5.4 Server Runnables: MotAg1CfgLoPwrMod <span>10</span></a></p>
<p><a href="#design-rationale-5">5.4.1.1 Design Rationale <span>10</span></a></p>
<p><a href="#store-module-inputs-to-local-copies-4">5.4.1.2 Store Module Inputs to Local copies <span>10</span></a></p>
<p><a href="#processing-of-function-4">5.4.1.3 (Processing of function)……… <span>11</span></a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs-4">5.4.1.4 Store Local copy of outputs into Module Outputs <span>11</span></a></p>
<p><a href="#interrupt-functions">5.5 Interrupt Functions <span>11</span></a></p>
<p><a href="#module-internal-local-functions">5.6 Module Internal (Local) Functions <span>11</span></a></p>
<p><a href="#processerrorreganddierevctr">5.6.1 ProcessErrorRegAndDieRevCtr <span>11</span></a></p>
<p><a href="#section">5.6.2 SPI_AnglePolarityAdjust <span>11</span></a></p>
<p><a href="#spivsenca">5.6.3 SPIvsENCA <span>12</span></a></p>
<p><a href="#calccorrntbl">5.6.4 CalcCorrnTbl <span>12</span></a></p>
<p><a href="#motagfaultprocessing">5.6.5 MotAgFaultProcessing <span>12</span></a></p>
<p><a href="#calcntcprm">5.6.6 CalcNtcPrm <span>13</span></a></p>
<p><a href="#setmotag1fltntc">5.6.7 SetMotAg1FltNtc <span>13</span></a></p>
<p><a href="#section-3">5.6.8 OffsetCalculation <span>14</span></a></p>
<p><a href="#calculatemotagturncntr">5.6.9 CalculateMotAgTurnCntr <span>14</span></a></p>
<p><a href="#spi_anglerawprocess">5.6.10 SPI_AngleRawProcess <span>15</span></a></p>
<p><a href="#compensatemechmtrpos">5.6.11 CompensateMechMtrPos <span>15</span></a></p>
<p><a href="#global-functionmacro-definitions">5.7 GLOBAL Function/Macro Definitions <span>16</span></a></p>
<p><a href="#known-limitations-with-design">6 Known Limitations with Design <span>17</span></a></p>
<p><a href="#unit-test-consideration">7 UNIT TEST CONSIDERATION <span>18</span></a></p>
<p><a href="#abbreviations-and-acronyms">Appendix A Abbreviations and Acronyms <span>19</span></a></p>
<p><a href="#glossary">Appendix B Glossary <span>20</span></a></p>
<h1 id="introduction">Introduction</h1>
<h2 id="purpose">Purpose</h2>
<p>This document defines the module level design for the Sensor Offset and Correction Component. Major part of design has been captured in the FDD and any design rationale that has not been identified in the FDD and has been used to implement the component has been documented in the MDD</p>
<h2 id="scope">Scope</h2>
<p>The following definitions are used throughout this document:</p>
<ul>
<li><p><strong><u>Shall</u></strong>: indicates a mandatory requirement without exception in compliance.</p></li>
<li><p><strong><u>Should</u></strong>: indicates a mandatory requirement; exceptions allowed only with documented justification.</p></li>
<li><p><strong><u>May</u></strong>: indicates an optional action.</p></li>
</ul>
<h1 id="motag1meashigh-level-description">MotAg1MeasHigh-Level Description</h1>
<p>The CDD_MotAg1Meas component is the complex driver for the motor angle 1 measurement subsystem. This function initializes the registers for CSIH3 SPI channel for communicating with the motor angle 1 measurement sensor board. The SPI transmission is triggered periodically by DMA component. This function receives the RAW sensor data at 62.5uS rate. The component contains two source files, both described in this MDD: CDD_MotAg1Meas.c contains the RTE runnables and services; CDD_MotAg1Meas_MotCtrl.c contains the motor control runnable.</p>
<p>.</p>
<h1 id="design-details-of-software-module">Design details of software module</h1>
<p>See FDD.</p>
<h2 id="graphical-representation-of-motag1meas">Graphical representation of MotAg1Meas</h2>
<h2 id="data-flow-diagram">Data Flow Diagram</h2>
<p>See FDD.</p>
<h3 id="component-level-dfd">Component level DFD</h3>
<p>See FDD.</p>
<h3 id="function-level-dfd">Function level DFD</h3>
<p>See FDD.</p>
<h1 id="constant-data-dictionary">Constant Data Dictionary</h1>
<h2 id="program-fixed-constants">Program (fixed) Constants</h2>
<h3 id="embedded-constants">Embedded Constants</h3>
<h4 id="local-constants">Local Constants</h4>
<table>
<colgroup>
<col style="width: 47%" />
<col style="width: 20%" />
<col style="width: 14%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th>Constant Name</th>
<th>Resolution</th>
<th>Units</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MOTAG1TURNCNTRLOLIM_CNT_F32</td>
<td>Single point</td>
<td>Cnt</td>
<td>-256.09375</td>
</tr>
<tr class="even">
<td>MOTAG1TURNCNTRHILIM_CNT_F32</td>
<td>Single point</td>
<td>Cnt</td>
<td>255.96875</td>
</tr>
<tr class="odd">
<td>MOTCTRLMOTAG1WARNREGLOLIM_CNT_U32</td>
<td>1</td>
<td>Cnt</td>
<td>0</td>
</tr>
<tr class="even">
<td>MOTCTRLMOTAG1WARNREGHILIM_CNT_U32</td>
<td>1</td>
<td>Cnt</td>
<td>67108863</td>
</tr>
<tr class="odd">
<td>MOTCTRLMOTAG1ERRREGLOLIM_CNT_U32</td>
<td>1</td>
<td>Cnt</td>
<td>0</td>
</tr>
<tr class="even">
<td>MOTCTRLMOTAG1ERRREGHILIM_CNT_U32</td>
<td>1</td>
<td>Cnt</td>
<td>67108863</td>
</tr>
<tr class="odd">
<td>MOTCTRLMOTAG1TURNCNTRREGLOLIM_CNT_U32</td>
<td>1</td>
<td>Cnt</td>
<td>0</td>
</tr>
<tr class="even">
<td>MOTCTRLMOTAG1TURNCNTRREGHILIM_CNT_U32</td>
<td>1</td>
<td>Cnt</td>
<td>67108863</td>
</tr>
</tbody>
</table>
<p><strong>* Also see see FDD – CM640B_MotAg1Meas_DataDict.m file</strong></p>
<h1 id="software-component-implementation">Software Component Implementation</h1>
<h2 id="sub-module-functions">Sub-Module Functions</h2>
<p>The sub-module functions are grouped based on similar functionality that needs to be executed in a given “State” of the system (refer States and Modes). For a given module, the MDD will identify the type and number of sub-modules required. The sub-module types are described below.</p>
<h3 id="init-motag1measinit1">Init: MotAg1MeasInit1</h3>
<h2 id="design-rationale">Design Rationale</h2>
<p>All register initialization that is allowed at the register level (see Register/Field column of the CM640A_MotAg1Meas_RegisterConfiguration.xlsm spreadsheet in the FDD) is done at the register level to save execution time as compared to the read/modify/writes that would be needed to initialize at the field level. Field level initialization done only where required by the spreadsheet.</p>
<h2 id="module-outputs">Module Outputs</h2>
<p>See FDD: MotAg1MeasInit1 model block.</p>
<h2 id="module-internal">Module Internal </h2>
<p>See FDD: MotAg1MeasInit1 model block for Per Instance Memory.</p>
<h3 id="per-motag1measper1">Per: MotAg1MeasPer1</h3>
<h2 id="design-rationale-1">Design Rationale</h2>
<p>For run time efficiency in the motor control loop the <strong>Compensate MechMtrPos</strong> block is implemented in a optimized way in the code by letting a uint16 variable be overflown</p>
<h2 id="store-module-inputs-to-local-copies">Store Module Inputs to Local copies</h2>
<p>See FDD: MotAg1MeasPer1 model block</p>
<h2 id="processing-of-function">(Processing of function)………</h2>
<p>See FDD: MotAg1MeasPer1 model block.</p>
<h2 id="store-local-copy-of-outputs-into-module-outputs">Store Local copy of outputs into Module Outputs</h2>
<p>See FDD: MotAg1MeasPer1 model block.</p>
<h3 id="per-motag1measper2">Per: MotAg1MeasPer2</h3>
<h2 id="design-rationale-2">Design Rationale</h2>
<p>Details of the implementation of block “Process MotAg1RawErr” differ from the model in order to meet design and coding standards.</p>
<h2 id="store-module-inputs-to-local-copies-1">Store Module Inputs to Local copies</h2>
<p>See FDD: MotAg1MeasPer2 model block</p>
<h2 id="processing-of-function-1">(Processing of function)………</h2>
<p>See FDD: MotAg1MeasPer2 model block.</p>
<h2 id="store-local-copy-of-outputs-into-module-outputs-1">Store Local copy of outputs into Module Outputs</h2>
<p>See FDD: MotAg1MeasPer2 model block.</p>
<h2 id="server-runnables-motag1coefftblread">Server Runnables: MotAg1CoeffTblRead</h2>
<h2 id="design-rationale-3">Design Rationale</h2>
<p>None</p>
<h2 id="store-module-inputs-to-local-copies-2">Store Module Inputs to Local copies</h2>
<p>None</p>
<h2 id="processing-of-function-2">(Processing of function)………</h2>
<p><em>See</em> MotAg1CoeffTblRead <em>block in the FDD</em></p>
<h2 id="store-local-copy-of-outputs-into-module-outputs-2">Store Local copy of outputs into Module Outputs</h2>
<p>None</p>
<h2 id="server-runnables-motag1coefftblwr">Server Runnables: MotAg1CoeffTblWr</h2>
<h2 id="design-rationale-4">Design Rationale</h2>
<p>None</p>
<h2 id="store-module-inputs-to-local-copies-3">Store Module Inputs to Local copies</h2>
<p>None</p>
<h2 id="processing-of-function-3">(Processing of function)………</h2>
<p><em>See</em> MotAg1CoeffTblWr <em>block in the FDD</em></p>
<h2 id="store-local-copy-of-outputs-into-module-outputs-3">Store Local copy of outputs into Module Outputs</h2>
<p><em>See</em> MotAg1MeasMotAg1CoeffTblWr<em>block in the FDD</em></p>
<h2 id="server-runnables-motag1cfglopwrmod">Server Runnables: MotAg1CfgLoPwrMod</h2>
<h2 id="design-rationale-5">Design Rationale</h2>
<p>None</p>
<h2 id="store-module-inputs-to-local-copies-4">Store Module Inputs to Local copies</h2>
<p>None</p>
<h2 id="processing-of-function-4">(Processing of function)………</h2>
<p><em>See</em> <em>MotAg1CfgLoPwrMod</em> <em>block in the FDD</em></p>
<h2 id="store-local-copy-of-outputs-into-module-outputs-4">Store Local copy of outputs into Module Outputs</h2>
<p><em>See MotAg1CfgLoPwrMo</em>d <em>block in the FDD</em></p>
<h2 id="interrupt-functions">Interrupt Functions</h2>
<p>None</p>
<h2 id="module-internal-local-functions">Module Internal (Local) Functions</h2>
<h3 id="processerrorreganddierevctr">ProcessErrorRegAndDieRevCtr</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>ProcessErrorRegAndDieRevCtr</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>MotAgErrReg_Cnt_T_u32</td>
<td>uint32</td>
<td>0</td>
<td>67108863</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgTurnCntrReg_Cnt_T_u32</td>
<td>uint32</td>
<td>0</td>
<td>67108863</td>
</tr>
<tr class="even">
<td></td>
<td>MotAgWarnReg_Cnt_T_u32</td>
<td>uint32</td>
<td>0</td>
<td>67108863</td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>MotAg1Err_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td></td>
<td>MotAg1Warn_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>TurnCntrParFltCnt_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td></td>
<td>TurnCntr_Cnt_T_s16</td>
<td>sint16</td>
<td>-2048</td>
<td>2048</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgTurnCntrRollgCntr_Cnt_T_u08</td>
<td>uint8</td>
<td>0</td>
<td>65535</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-6">Design Rationale</h4>
<p>Implementation of "Process ErrorReg and DieRevCtr" Simulink block</p>
<h3 id="section"></h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="section-1"></h4>
<h3 id="spivsenca">SPIvsENCA</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>SPIvsENCA</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>MotAgSpiMecl_MotRev_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgEncaMecl_MotRev_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td><strong>Return Value</strong></td>
<td>MotAgSyncErr_Cnt_T_u08</td>
<td>uint8</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-7">Design Rationale</h4>
<p>Implementation of "SPI vs ENCA" Simulink block</p>
<h3 id="calccorrntbl">CalcCorrnTbl</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>CalcCorrnTbl</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>None</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-8">Design Rationale</h4>
<p>See “Calculate Correction Table” block in the Simulink model of the design</p>
<h3 id="motagfaultprocessing">MotAgFaultProcessing</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>MotAgFaultProcessing</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>MotAgErr_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgWarn_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td></td>
<td>TurnCntrParFltCnt_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgVltgFltCnt_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td></td>
<td>MotAgParFltCnt_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgSyncErr_Cnt_T_u16</td>
<td>uint8</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td></td>
<td>MotAg4Mecl_MotRev_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgSpiMecl_MotRev_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td></td>
<td>TurnCntr_Cnt_T_s16</td>
<td>sint16</td>
<td>-2048</td>
<td>2048</td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>MotAgQlfr_Cnt_T_enum</td>
<td>SigQlfr1</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="even">
<td></td>
<td>MotAgTurnCntrQlfr_Cnt_T_enum</td>
<td>SigQlfr1</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgQepFaild_Cnt_T_logl</td>
<td>boolean</td>
<td>FALSE</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-9">Design Rationale</h4>
<p>Implementation of "MotAg Fault Processing" Simulink block</p>
<h3 id="calcntcprm">CalcNtcPrm</h3>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 47%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>CalcNtcPrm</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>MotAgErr_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgWarn_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td></td>
<td>TurnCntrParFltCnt_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgVltgFltCnt_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td></td>
<td>MotAgParFltCnt_Cnt_T_u16</td>
<td>uint16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>MotAgNtcParm_Cnt_T_u08</td>
<td>uint8</td>
<td>0</td>
<td>127</td>
</tr>
<tr class="even">
<td></td>
<td>TurnCtrNtcParm_Cnt_T_u08</td>
<td>uint8</td>
<td>0</td>
<td>255</td>
</tr>
<tr class="odd">
<td></td>
<td>TurnCtrVltgNtcParm_Cnt_T_u08</td>
<td>uint8</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-10">Design Rationale</h4>
<p>See “Determine NTC Parameters” block in the Simulink model of the design</p>
<h3 class="unnumbered" id="section-2"></h3>
<h3 id="setmotag1fltntc">SetMotAg1FltNtc</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>SetMotAg1FltNtc</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>MotAgNtcParm_Cnt_T_u08</td>
<td>uint8</td>
<td>0</td>
<td>127</td>
</tr>
<tr class="odd">
<td></td>
<td>TurnCntrNtcParm_Cnt_T_u08</td>
<td>uint8</td>
<td>0</td>
<td>255</td>
</tr>
<tr class="even">
<td></td>
<td>TurnCntrVltgNtcParm_Cnt_T_u08</td>
<td>uint8</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAgQepMecl_MotRev_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="even">
<td></td>
<td>MotAgSPIMecl__MotRev_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>TurnCntr_Cnt_T_s16</td>
<td>sint16</td>
<td>-2048</td>
<td>2048</td>
</tr>
<tr class="even">
<td><strong>Return Value</strong></td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-11">Design Rationale</h4>
<p>See “MotAg1PtrclFlt Processing, MotAg1TurnCntrFlt Processing &amp; MotAg1TurnCntrVltgFlt Processing” block in the Simulink model of the design</p>
<h3 id="section-3"><br />
 </h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><h3 id="section-4" class="unnumbered"></h3></td>
<td><h3 id="section-5" class="unnumbered"></h3></td>
<td><h3 id="section-6" class="unnumbered"></h3></td>
<td><h3 id="section-7" class="unnumbered"></h3></td>
<td><h3 id="section-8" class="unnumbered"></h3></td>
</tr>
<tr class="even">
<td><h3 id="section-9" class="unnumbered"></h3></td>
<td><h3 id="section-10" class="unnumbered"></h3></td>
<td><h3 id="section-11" class="unnumbered"></h3></td>
<td><h3 id="section-12" class="unnumbered"></h3></td>
<td><h3 id="section-13" class="unnumbered"></h3></td>
</tr>
<tr class="odd">
<td><h3 id="section-14" class="unnumbered"></h3></td>
<td><h3 id="section-15" class="unnumbered"></h3></td>
<td><h3 id="section-16" class="unnumbered"></h3></td>
<td><h3 id="section-17" class="unnumbered"></h3></td>
<td><h3 id="section-18" class="unnumbered"></h3></td>
</tr>
<tr class="even">
<td><h3 id="section-19" class="unnumbered"></h3></td>
<td><h3 id="section-20" class="unnumbered"></h3></td>
<td><h3 id="section-21" class="unnumbered"></h3></td>
<td><h3 id="section-22" class="unnumbered"></h3></td>
<td><h3 id="section-23" class="unnumbered"></h3></td>
</tr>
</tbody>
</table>
<h3 class="unnumbered" id="section-24"></h3>
<h3 class="unnumbered" id="section-25"></h3>
<h3 class="unnumbered" id="section-26"></h3>
<h3 id="calculatemotagturncntr">CalculateMotAgTurnCntr</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>CalculateMotAgTurnCntr</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>MotAgSpiMecl_MotRev_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td></td>
<td>TurnCntr_Cnt_T_s16</td>
<td>sint16</td>
<td>-2048</td>
<td>2048</td>
</tr>
<tr class="even">
<td></td>
<td>MotAgPolarity_Cnt_T_s08</td>
<td>sint8</td>
<td>-1</td>
<td>1</td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>MotAgTurnCntr_Cnt_T_f32</td>
<td>float32</td>
<td>-256.09375</td>
<td>255.96875</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-12">Design Rationale</h4>
<p>Implementation of "Calculate MotAgTurnCntr" Simulink block</p>
<h3 id="spi_anglerawprocess"><br />
SPI_AngleRawProcess</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>SPI_AngleRawProcess</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>RawAngReg_Cnt_T_u32</td>
<td>uint32</td>
<td>0</td>
<td>67108863</td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-13">Design Rationale</h4>
<p>Implementation of "SPI_AngleRawProcess" Simulink block</p>
<h3 id="compensatemechmtrpos">CompensateMechMtrPos</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>CompensateMechMtrPos</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>MotAgRawMecl_Cnt_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>MotAgMecl_MotRev_T_u0p16</td>
<td>u0p16</td>
<td>0</td>
<td>65535</td>
</tr>
</tbody>
</table>
<h4 id="design-rationale-14">Design Rationale</h4>
<p>Implementation of "Compensate MechMtrPos" Simulink block</p>
<h2 id="global-functionmacro-definitions"><br />
GLOBAL Function/Macro Definitions</h2>
<p>None</p>
<h1 id="known-limitations-with-design">Known Limitations with Design</h1>
<p>Analysis was done to ensure the datatype sm5p12 is sufficient to hold worst case values for the MotAg1CorrlnTbl.  This analysis will be added to the FDD.  See CR EA4#14937.  In addition, the correlation table values are verified in manufacturing after writing the coefficient table to NVM.</p>
<h1 id="unit-test-consideration">UNIT TEST CONSIDERATION</h1>
<p>Following variables are used as rolling counters, so the overflow of these variables is intentional.</p>
<p>Rte_Pim_MotAg1VltgFltCntPrev</p>
<p>Rte_Pim_MotAg1ParFltCntPrev</p>
<p>Rte_Pim_MotAg1MeclRollgCntrPrev</p>
<p>Rte_Pim_MotAg1TurnCntrParFltCntPrev</p>
<p>There is code in the SinCos_f32() function which will not be covered in this component, because the input to this function is always positive. This is ok as the SinCos_f32() is a library function.</p>
<p>For the config param MOTAG1MEAS_DIQEPIF_CNT_LOGL please use the file CDD_MotAg1Meas_Cfg.h in the include folder.</p>
<p class="heading" id="abbreviations-and-acronyms">Abbreviations and Acronyms</p>
<table>
<colgroup>
<col style="width: 32%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Abbreviation or Acronym</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p class="heading" id="glossary">Glossary</p>
<p><strong>Note</strong>: Terms and definitions from the source “Nexteer Automotive” take precedence over all other definitions of the same term. Terms and definitions from the source “Nexteer Automotive” are formulated from multiple sources, including the following:</p>
<ul>
<li><p>ISO 9000</p></li>
<li><p>ISO/IEC 12207</p></li>
<li><p>ISO/IEC 15504</p></li>
<li><p>Automotive SPICE® Process Reference Model (PRM)</p></li>
<li><p>Automotive SPICE® Process Assessment Model (PAM)</p></li>
<li><p>ISO/IEC 15288</p></li>
<li><p>ISO 26262</p></li>
<li><p>IEEE Standards</p></li>
<li><p>SWEBOK</p></li>
<li><p>PMBOK</p></li>
<li><p>Existing Nexteer Automotive documentation</p></li>
</ul>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 53%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Term</strong></th>
<th><strong>Definition</strong></th>
<th><strong>Source</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MDD</td>
<td>Module Design Document</td>
<td></td>
</tr>
<tr class="even">
<td>DFD</td>
<td>Data Flow Diagram</td>
<td></td>
</tr>
</tbody>
</table>
<p>References</p>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 69%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Ref. #</strong></th>
<th><strong>Title</strong></th>
<th><strong>Version</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>AUTOSAR Specification of Memory Mapping (Link:AUTOSAR_SWS_MemoryMapping.pdf)</td>
<td>v1.3.0 R4.0 Rev 2</td>
</tr>
<tr class="even">
<td>2</td>
<td>MDD Guideline</td>
<td>EA4 01.00.00</td>
</tr>
<tr class="odd">
<td>3</td>
<td>EA4 Software Naming Conventions</td>
<td>01.01.00</td>
</tr>
<tr class="even">
<td>4</td>
<td>Software Design and Coding Standards.doc</td>
<td>2.1</td>
</tr>
<tr class="odd">
<td>5</td>
<td>FDD – CM640B Motor Angle 1 Measure</td>
<td>See Synergy subproject version</td>
</tr>
</tbody>
</table>
